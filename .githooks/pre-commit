#!/bin/bash

set -e

echo "Running pre-commit hooks..."

# Run golangci-lint with auto-fix
echo "ğŸ” Running golangci-lint..."
if command -v golangci-lint >/dev/null 2>&1; then
    golangci-lint run --fix
    if [ $? -ne 0 ]; then
        echo "âŒ golangci-lint failed. Please fix the issues and try again."
        exit 1
    fi
    echo "âœ… golangci-lint passed"
else
    echo "âš ï¸  golangci-lint not found. Please install it: https://golangci-lint.run/usage/install/"
    exit 1
fi

echo "ğŸ§ª Running tests..."
go test ./...
if [ $? -ne 0 ]; then
    echo "âŒ Tests failed. Please fix the issues and try again."
    exit 1
fi
echo "âœ… Tests passed"

git add -A

echo "âœ… All pre-commit checks passed!"
